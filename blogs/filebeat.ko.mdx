---
id: 125
date: 2023-09-12
tags: ["filebeat", "elk"]
title: Filebeat
slug: filebeat
seq: 4
type: interest
language: kr
featureImage: /images/interest/filebeat.png
thumb: /images/interest/filebeat_icon.jpg
github:
demo: http://imcmaster.iptime.org:5601/app/dashboards#/view/79ffd6e0-faa0-11e6-947f-177f697178b8-ecs?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:'2023-09-12T02:00:00.000Z',to:now))
videoSourceURL:
videoTitle:
excerpt: 간편하게 메트릭 데이터를 수집.
---

### Filebeat → Elastic Search 조회

<SearchStep
  items={[
    {
      title: "Intro",
      
      content: (
      <SearchSingle
       
        comment={
          <Diagram schema={{
              nodes: [
              { id: "node-1", content: <Tooltipp
                  content={
                    <div className="px-1 py-2">
                      <div className="text-small font-bold">filebeat.yml setup & run</div>
                      <div className="text-tiny">yml파일내 input, output을 설정한다.</div>
                      <div className="text-tiny">bin/filebeat -f filebeat.yml로 실행한다.</div>
                    </div>
                  }
                ><img src="/images/interest/filebeat.png" width="120px" alt="pipeline" />
                </Tooltipp>, coordinates: [150, 60] },

              { id: "node-4", content:  <Tooltipp
                  content={
                    <div className="px-1 py-2">
                      <div className="text-small font-bold">Elastic 조회</div>
                      <div className="text-tiny">filebeat output으로 elastic을 설정했음</div>
                      <div className="text-tiny">curl로 조회</div>
                    </div>
                  }
                >
                <img src="/images/interest/elastic_icon1.png" width="120px" alt="elastic" />
                </Tooltipp>, coordinates: [400, 60] },
              ],
              links: [
              { input: "node-1", output: "node-4" }
              ],
              }}/>
        }
      ></SearchSingle>
      ),
    },
    {
      title: "Filebeat 실행",
        content: (
          <>
        <SearchShow
          script="ssh nam cat /home/yknam/sandbox/filebeat/conf/filebeat1_short.yml"
          script1="ssh nam /home/yknam/sandbox/filebeat/filebeat -c /home/yknam/sandbox/filebeat/conf/filebeat1.yml"
          type1="json"
          buttonname="view filebeat,run filebeat"
          comment={
            <>
            run filebeat를 클릭해서 filebeat를 실행하세요"👉
            <Spacee><Chipp color="warning" variant="bordered">filebeat.yml </Chipp>
            <Codee>
             cat ~/filebeat/conf/filebeat1.yml
            </Codee></Spacee> <br />
             <Spacee><Chipp  color="warning" variant="bordered">filebeat실행</Chipp>
            <Codee>
              ~/filebeat/filebeat -f conf/filebeat1.yml
            </Codee>
          </Spacee> <br />
            <Spacee><Chipp  color="warning" variant="bordered">kill 60초후</Chipp>
            <Codee>
              sleep 10; kill -9 $(pidof 'filebeat')"
            </Codee></Spacee>
            <Dividerr className="mb-5"/>
            </>
          }
        ></SearchShow>
        </>
      ),
    },

    {
      title: "Elastic Search 조회",
        content: (
        <SearchShow1
          script="curl get http://imcmaster.iptime.org:9200/filebeat*/_search"
          script1="ssh nam rm -rf /home/yknam/sandbox/filebeat/data;ssh nam curl -X DELETE localhost:9200/filebeat\*"
          buttonname="view,reset"
          type="json"
          comment={
            <>
            reset을 클릭시 filebeat data와 data folder삭제 👉<br/>
            <Codee>
              curl get http://localhost:9200/filebeat*/_search
            </Codee>


            </>
          }
        ></SearchShow1>
      ),
        status: "wait",
      disabled: true,
    },

]}
/>

### Filebeat 설정 (filebeat.yml)

> filebeat.yml파일에 input, output을 설정하여 실행한다. 하나씩만 설정, 실행할 수 있다.
> input 데이터 소스로 nginx 로그를 수집하는 예이다. type->log, enable->true,path->/var/log/nginx/access.log로 설정한다.
> output 으로 elatic을 선택했다. logstash를 거쳐 filtering해서 elastic으로 전송할 경우에는 elastic을 주석처리하고 logstash를 활성화하면된다.

#### filebeat.yml

<SearchScript filename="filebeatyml" />

💡 filebeat는 한번 실행한 데이터는 다시 읽지 않기 때문에 새로 데이터를 읽으려면 data디렉토리를 삭제한 후 실행해야함

### input

<SearchTab
  arr={[
    {
      id: "elasticsearch",
      label: "elasticsearch",
      content: (
        <SearchShow
          script="ssh nam cat /home/yknam/sandbox/filebeat/conf/filebeat1.yml"
          script1="curl get http://imcmaster.iptime.org:9200/filebeat*/_search"
          type1="json"
          comment1={
            <>
            <Chipp>filebeat → elasticsearch</Chipp>
            <Codee>

              curl get http://localhost:9200/filebeat*/_search
            </Codee>
            </>
          }
        ></SearchShow>
      ),
    },
    {
      id: "logstash",
      label: "logstash",
      content: (
        <SearchScript
          filename="mappings_update"
          type="json"
          script1="console.log('hi')"
        ></SearchScript>
      ),
    },
    {
      id: "kafka",
      label: "kafka",
      content:
        "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
    },
    {
      id: "sparkstreaming",
      label: "sparkstreaming",
      content:
        "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
    },
    {
      id: "redis",
      label: "redis",
      content:
        "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
    },

]}
/>

### output

<SearchTab
  arr={[
    {
      id: "elasticsearch",
      label: "elasticsearch",
      content: <SearchShow script="ls -la" script1="ls -la"></SearchShow>,
    },
    {
      id: "logstash",
      label: "logstash",
      content: (
        <SearchScript
          filename="mappings_update"
          type="json"
          script1="console.log('hi')"
        ></SearchScript>
      ),
    },
    {
      id: "kafka",
      label: "kafka",
      content:
        "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
    },
    {
      id: "sparkstreaming",
      label: "sparkstreaming",
      content:
        "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
    },
  ]}
/>
