---
id: 21
date: 2021-12-31
tags: ["cloud"]
title: MinIO
slug: minio
seq: 1
type: interest
language: kr
featureImage: /images/interest/minio_logo.png
thumb: /images/interest/minio_logo2.png
github:
demo: http://imcmaster.iptime.org:9010
excerpt: s3 compatible storage solution. Custom install with docker-compose
---

### Contents

|bash|Backup docker volume and push to minIO|도커볼륨의 백업을 압축후(tar.bz2 포맷) minIO로
업로드하는 script

```bash
#!/bin/bash

array=(mysql-data,postgres-data,wp-content, mongodbdata ,minio-data)

echo "Array size: ${#array[*]}"

echo "Array items:"
for item in ${array[*]}
do
    printf "   %s\n" $item
    docker run --rm -v $item:/volume -v /tmp:/backup alpine tar -cjf /backup/$item.tar.bz2 -C /volume ./
    s3cmd -c ~/.s3cfg_minio put /tmp/$item.tar.bz2 s3://backup
done
```

|bash|Restore code|Get from minIO and restore, minIO backup bucker의 tar.bz2 파일을 다운받은 후
도커볼륨으로 save하는 script

```bash
#!/bin/bash
array=(mysql-data postgres-data mongodbdata wp-content minio-data)

echo "Array items:"

for item in ${array[*]}
do

        s3cmd -c ~/.s3cfg_minio_nam --force get s3://backup/$item.tar.bz2 /tmp/
        volumes=$(docker volume ls)

        exist=0;
        for vol in ${volumes[*]}
        do
        if [ $vol == $item ]
        then
                exist=1
        fi
        done

        if [ $exist == 0 ]
        then
        docker volume create $item
        docker run --rm -v $item:/volume -v /tmp:/backup alpine sh -c
        "rm -rf /volume/* /volume/..?* /volume/.[!.]* ; tar -C /volume/ -xjf /backup/$item.tar.bz2"

        printf "   %s\n" $item
        fi
done
```

### minio setting - /etc/default/minio

<SearchSingle script="ssh nam cat /etc/default/minio" />
<SearchTab
  arr={[
    {
      id: "removeBucket",
      label: "removeBucket",
      content: <SearchShow script="cat /home/yknam/nodefiles/minio/removeBucket.js" script1="/home/yknam/nodefiles/minio/removeBucket.js"></SearchShow>,
    },
    {
      id: "uploadFile",
      label: "uploadFile",
      content: (
        <SearchShow
         script="cat /home/yknam/nodefiles/minio/uploadFile.js" script1="/home/yknam/nodefiles/minio/uploadFile.js"
        ></SearchShow>
      ),
    },

]}
/>

<SearchSingle script="ssh nam aws s3 ls --endpoint-url http://localhost:9010"></SearchSingle>

<SearchTab
  arr={[
    {
      id: "elasticsearch",
      label: "elasticsearch",
      content: (
        <SearchShow
          script="ssh nam cat /home/yknam/sandbox/filebeat/conf/filebeat1.yml"
          script1="curl get http://imcmaster.iptime.org:9200/filebeat*/_search"
          type1="json"
          comment1={
            <>
            <Chipp>filebeat → elasticsearch</Chipp>
            <Codee>

              curl get http://localhost:9200/filebeat*/_search
            </Codee>
            </>
          }
        ></SearchShow>
      ),
    },
    {
      id: "logstash",
      label: "logstash",
      content: (
        <SearchScript
          filename="mappings_update"
          type="json"
          script1="console.log('hi')"
        ></SearchScript>
      ),
    },
    {
      id: "kafka",
      label: "kafka",
      content:
        "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
    },
    {
      id: "sparkstreaming",
      label: "sparkstreaming",
      content:
        "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
    },
    {
      id: "redis",
      label: "redis",
      content:
        "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
    },

]}
/>

### aws s3 ls --endpoint-url http://localhost:9010

### aws s3 mb s3://examplebucket --endpoint-url http://localhost:9010

### cd movie2;aws s3 cp . s3://examplebucket --recursive --endpoint-url http://localhost:9010

### aws s3 cp ~/movie2 s3://examplebucket --recursive --endpoint-url http://localhost:9010

### aws s3 cp ~/movielens s3://examplebucket --recursive --exclude "_" --include "_.txt" --endpoint-url http://localhost:9010

### aws s3 cp s3://examplebucket s3://myfirst --recursive --endpoint-url http://localhost:9010

### aws s3 rm s3://myfirst/README.txt --endpoint-url http://localhost:9010

### aws s3 rb s3://examplebucket --force --endpoint-url http://localhost:9010 # if not empty

### aws s3 rb s3://mysecond --endpoint-url http://localhost:9010 //if empty

### aws s3 sync ~/movielens s3://myfirst --endpoint-url http://localhost:9010 # 달라진 파일만 갱신

### mc tree

ssh nam mc tree /data/myfirst

### python minio

<SearchShow
  script="cat /home/yknam/pythonfiles/minio/fileuploader.py"
  script1="cat /home/yknam/test.txt"
  type1="json"
  buttonname="code,run"
></SearchShow>
<SearchSingle script="ssh nam mc tree /data/myfirst"></SearchSingle>
